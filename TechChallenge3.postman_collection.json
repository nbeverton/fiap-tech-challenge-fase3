{
  "info": {
    "name": "FIAP Tech Challenge - Fluxo Completo",
    "_postman_id": "fiap-techchallenge-collection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1 - Criar Address",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": {
          "raw": "{{baseUrl}}/addresses",
          "host": ["{{baseUrl}}"],
          "path": ["addresses"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"postalCode\": \"00012-345\",\n  \"streetName\": \"Av. Paulista\",\n  \"streetNumber\": 123,\n  \"additionalInfo\": \"Sala 1\",\n  \"neighborhood\": \"Centro\",\n  \"city\": \"São Paulo\",\n  \"stateProvince\": \"SP\",\n  \"country\": \"Brazil\"\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"addressId\", json.id);"
            ]
          }
        }
      ]
    },
    {
      "name": "2 - Criar User",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": {
          "raw": "{{baseUrl}}/users",
          "host": ["{{baseUrl}}"],
          "path": ["users"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Usuário Tech Challenge\",\n  \"userType\": \"CLIENT\",\n  \"email\": \"client.tc@example.com\",\n  \"login\": \"client.tc\",\n  \"password\": \"SenhaForte123!\",\n  \"addressId\": \"{{addressId}}\",\n  \"addressType\": \"HOME\",\n  \"label\": \"casa\"\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"userId\", json.id);"
            ]
          }
        }
      ]
    },
    {
      "name": "3 - Autenticar Client",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "host": ["{{baseUrl}}"],
          "path": ["auth", "login"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"login\": \"client.tc\",\n  \"password\": \"SenhaForte123!\"\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"token\", json.token);"
            ]
          }
        }
      ]
    },
    {
      "name": "4 - Criar Restaurante",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": {
          "raw": "{{baseUrl}}/restaurants",
          "host": ["{{baseUrl}}"],
          "path": ["restaurants"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Restaurante FIAP\",\n  \"addressId\": \"{{addressId}}\",\n  \"cuisineType\": \"BRAZILIAN\",\n  \"openingHours\": {\n    \"opens\": \"08:00\",\n    \"closes\": \"22:00\"\n  },\n  \"userId\": \"{{userId}}\",\n  \"menu\": []\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"restaurantId\", json.id);"
            ]
          }
        }
      ]
    },
    {
      "name": "5 - Criar Menu",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "url": {
          "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/menus",
          "host": ["{{baseUrl}}"],
          "path": ["restaurants", "{{restaurantId}}", "menus"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Prato do dia\",\n  \"description\": \"Arroz, feijão, bife e salada\",\n  \"price\": 39.90,\n  \"dineInAvailable\": true,\n  \"imageUrl\": \"https://example.com/pf.jpg\"\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"menuId\", json.id);"
            ]
          }
        }
      ]
    },

    {
      "name": "6 - Criar Pedido (JWT)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/orders",
          "host": ["{{baseUrl}}"],
          "path": ["orders"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"restaurantId\": \"{{restaurantId}}\",\n  \"userAddressId\": \"{{userAddressIdManual}}\",\n  \"items\": [\n    {\n      \"menuId\": \"{{menuId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var json = pm.response.json();",
              "pm.environment.set(\"orderId\", json.id);"
            ]
          }
        }
      ]
    },

    {
      "name": "7 - Atualizar Pedido (PUT)",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/orders/{{orderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["orders", "{{orderId}}"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"items\": [\n    {\n      \"menuItemId\": \"{{menuId}}\",\n      \"quantity\": 2\n    }\n  ]\n}"
        }
      }
    },
    {
      "name": "8 - Deletar Pedido (DELETE)",
      "request": {
        "method": "DELETE",
        "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
        "url": {
          "raw": "{{baseUrl}}/orders/{{orderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["orders", "{{orderId}}"]
        }
      }
    }
  ]
}
